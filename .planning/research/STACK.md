# Technology Stack

**Project:** Fornelli in Gara
**Researched:** 2026-02-21
**Mode:** Stack dimension — React + Vite + Supabase SPA on GitHub Pages

---

## Recommended Stack

### Core Framework

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| React | 19.x | UI framework | Ecosystem standard; Vite template ships with 19 |
| Vite | 6.x | Build tool / dev server | Fastest DX for SPA; first-class React+TS template |
| TypeScript | 5.x | Type safety | Already decided; Supabase CLI generates typed schema |

### Backend (Supabase)

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| @supabase/supabase-js | 2.97.0 (Feb 2026) | Client SDK — DB, Auth, Storage, Realtime | Official client; v2 is stable, active weekly releases |
| Supabase CLI | latest | Type generation, Edge Function management | `supabase gen types` syncs DB schema to TypeScript |

**Supabase key note (HIGH confidence — official docs):**
Supabase is transitioning from `VITE_SUPABASE_ANON_KEY` to `VITE_SUPABASE_PUBLISHABLE_KEY` (format: `sb_publishable_xxx`). Both work during the transition. Use the publishable key for new projects if the dashboard offers it; fall back to anon key otherwise.

**Initialization pattern:**
```typescript
// src/lib/supabase.ts
import { createClient } from '@supabase/supabase-js'
import type { Database } from './database.types'  // generated by CLI

export const supabase = createClient<Database>(
  import.meta.env.VITE_SUPABASE_URL,
  import.meta.env.VITE_SUPABASE_ANON_KEY
)
```

**Type generation script (add to package.json):**
```json
"gen-types": "supabase gen types --lang=typescript --project-id \"$SUPABASE_PROJECT_REF\" > src/lib/database.types.ts"
```

### Routing

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| react-router-dom | 7.13.0 (Jan 2026) | Client-side routing | v7 in declarative mode is a non-breaking upgrade from v6; HashRouter required for GitHub Pages |

**Use `HashRouter`, not `BrowserRouter`.**

GitHub Pages cannot serve dynamic routes — any hard refresh on `/contest/abc123` returns 404. HashRouter stores the path in the URL hash (`/#/contest/abc123`), which GitHub Pages never routes server-side. The workaround with `404.html` redirect hacks is fragile; HashRouter is the correct solution for this deploy target.

```typescript
// main.tsx
import { HashRouter } from 'react-router-dom'
```

**Note:** TanStack Router v1 is the alternative with stronger TypeScript ergonomics, but for this app's complexity (5-7 routes, no nested loaders), React Router in declarative mode is sufficient and has lower learning cost.

### State Management

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| Zustand | 5.0.11 (Feb 2026) | Global UI state | Minimal boilerplate; no re-render thrash; React Context sufficient for auth |

**Decision rationale:**

Use **Zustand** for global UI state (current contest, current user session, active tab, phase transitions). Use **React Context** only for dependency injection (e.g., passing a Supabase client down — though a module-level singleton is even simpler).

Do NOT use React Context for frequently-updated state. Voting state, leaderboard data, and dish lists mutate often; Context causes entire subtree re-renders on every update. Zustand slices per concern.

**Do NOT add Redux.** Overkill for this scale.

### Form Handling

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| react-hook-form | 7.71.2 (Feb 2026) | Form state, uncontrolled inputs | Performant; minimal re-renders; integrates with Zod |
| zod | 4.3.6 (Jan 2026) | Schema validation + type inference | `z.infer<typeof schema>` eliminates duplicate type definitions |
| @hookform/resolvers | latest | Connects Zod schema to RHF | Official bridge package |

**Pattern:**
```typescript
const schema = z.object({
  dishName: z.string().min(1).max(100),
  description: z.string().max(500).optional(),
})
type DishFormData = z.infer<typeof schema>

const { register, handleSubmit, formState: { errors } } = useForm<DishFormData>({
  resolver: zodResolver(schema)
})
```

### Photo Upload / Compression

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| browser-image-compression | 2.0.2 | Client-side JPEG compression before Supabase Storage upload | Web Workers support = non-blocking UI; handles max dimension + quality targets |

**Configuration for this project (per PROJECT.md constraints: max 800px, quality 0.72 JPEG):**
```typescript
import imageCompression from 'browser-image-compression'

const options = {
  maxSizeMB: 0.8,
  maxWidthOrHeight: 800,
  useWebWorker: true,
  fileType: 'image/jpeg',
  initialQuality: 0.72,
}
const compressedFile = await imageCompression(file, options)
```

**Why not compressorjs:** Uses `canvas.toBlob()` directly, no Web Worker support — blocks the main thread during compression, which is noticeable on mobile with multi-photo uploads.

**Why not canvas API manually:** Unnecessary complexity when browser-image-compression handles orientation (EXIF), format conversion, and threading.

### QR Code Generation

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| qrcode.react | 4.2.0 (Dec 2025, React 19 support) | Render QR codes as SVG or Canvas in React | Most adopted; actively maintained; SVG output means no pixelation on screens |

**Usage:**
```tsx
import { QRCodeSVG } from 'qrcode.react'

<QRCodeSVG
  value={shareUrl}
  size={200}
  bgColor="#ffffff"
  fgColor="#1a1a2e"
  level="M"
/>
```

**Why not react-qr-code (2.0.18):** Both libraries are viable. `qrcode.react` has higher weekly download counts and explicitly added React 19 peer dep in its latest release; it's the safer choice by ecosystem weight.

### Styling

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| Tailwind CSS | 4.x | Utility-first CSS | Already decided; Vite plugin available; v4 removes config file for simple projects |

**Google Fonts** — load via `<link>` in `index.html`, not via npm package:
```html
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet">
```

### Testing

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| Vitest | 4.0.18 (Jan 2026) | Unit/component test runner | Uses same Vite config; Jest-compatible API; no separate config file |
| @testing-library/react | latest | Component testing utilities | Standard for React component tests |
| @testing-library/user-event | latest | Simulates real user interactions | Replaces `fireEvent` for more realistic tests |
| @testing-library/jest-dom | latest | DOM assertion matchers | `toBeInTheDocument()`, `toHaveValue()`, etc. |
| jsdom | latest | Simulates browser environment in Node | Required by Vitest for React component tests |

**Vitest config addition to vite.config.ts:**
```typescript
test: {
  globals: true,
  environment: 'jsdom',
  setupFiles: './src/test/setup.ts',
}
```

**Scope for this project:** Test business logic (vote validation, phase transition rules, hash functions) and critical form interactions. Do NOT aim for exhaustive UI test coverage on a small friend-group app — it slows velocity without proportional safety.

### Build / Deploy Pipeline

| Technology | Purpose | Why |
|------------|---------|-----|
| gh-pages (npm package) | Push `dist/` to `gh-pages` branch | Simplest deploy path for static SPA |
| GitHub Actions | CI: run tests + build on PR, deploy on main merge | Automates what `npm run deploy` does manually |

**Required vite.config.ts setting:**
```typescript
export default defineConfig({
  base: '/cooking_contest/',  // must match repo name exactly
  // ...
})
```

**package.json deploy scripts:**
```json
"predeploy": "npm run build",
"deploy": "gh-pages -d dist"
```

**React Router basename must match:**
```typescript
<HashRouter>  // no basename needed — hash routing is repo-path-independent
```

**GitHub Actions workflow** (`.github/workflows/deploy.yml`):
```yaml
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: '20' }
      - run: npm ci
      - run: npm test -- --run
      - run: npm run build
      - uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
```

---

## Alternatives Considered

| Category | Recommended | Alternative | Why Not |
|----------|-------------|-------------|---------|
| Router | react-router-dom v7 (HashRouter) | TanStack Router v1 | Overkill for 5-7 routes; React Router v7 closes the type-safety gap |
| Router (hash) | HashRouter | BrowserRouter + 404.html hack | 404.html redirect is fragile and adds script injection in index.html |
| State | Zustand | Redux Toolkit | 4x boilerplate for no benefit at this scale |
| State | Zustand | Jotai | Both are fine; Zustand has simpler mental model for slice-based stores |
| Forms | react-hook-form + zod | Formik + yup | RHF performs better; Zod infers TS types; Formik is declining in adoption |
| Images | browser-image-compression | compressorjs | No Web Worker support in compressorjs = main thread blocking |
| Images | browser-image-compression | Manual Canvas API | Unnecessary complexity; no EXIF rotation handling |
| QR | qrcode.react | react-qr-code | Both valid; qrcode.react has higher ecosystem weight |
| Testing | Vitest | Jest | Vitest shares Vite config; no separate babel transform needed |
| CSS | Tailwind | CSS Modules | Already decided; Tailwind is faster for mobile-first utility work |

---

## Installation

```bash
# Core dependencies
npm install @supabase/supabase-js react-router-dom zustand

# Forms
npm install react-hook-form zod @hookform/resolvers

# Photo compression
npm install browser-image-compression

# QR code
npm install qrcode.react

# Dev dependencies
npm install -D vitest @testing-library/react @testing-library/user-event @testing-library/jest-dom jsdom gh-pages
```

**Supabase CLI (for type generation — install globally or via npx):**
```bash
npm install -D supabase
```

---

## Confidence Assessment

| Library | Version Confidence | Notes |
|---------|--------------------|-------|
| @supabase/supabase-js | HIGH | Verified via GitHub releases: v2.97.0 published Feb 18, 2026 |
| react-router-dom | HIGH | Verified via GitHub releases: v7.13.0 published Jan 23, 2026 |
| zustand | HIGH | Verified via GitHub releases: v5.0.11 published Feb 1, 2026 |
| react-hook-form | HIGH | Verified via GitHub releases: v7.71.2 published Feb 20, 2026 |
| zod | HIGH | Verified via GitHub releases: v4.3.6 published Jan 22, 2026 (note: v4 is a major version — verify breaking changes vs v3 if upgrading) |
| browser-image-compression | HIGH | Verified via GitHub releases: v2.0.2 (year not fully confirmed — confirmed March release, year unclear) |
| qrcode.react | HIGH | Verified via GitHub releases: v4.2.0 published Dec 2025 |
| vitest | HIGH | Verified via GitHub releases: v4.0.18 published Jan 22, 2026 |
| HashRouter for GitHub Pages | HIGH | Multiple official GitHub Community discussions confirm BrowserRouter does not work without server-side redirect config |
| Tailwind v4 | MEDIUM | v4 is current major; Vite plugin setup changed from v3 — verify docs at time of implementation |

---

## Sources

- [Supabase React Quickstart](https://supabase.com/docs/guides/getting-started/quickstarts/reactjs)
- [Supabase TypeScript Support Docs](https://supabase.com/docs/reference/javascript/typescript-support)
- [supabase-js GitHub Releases](https://github.com/supabase/supabase-js/releases)
- [react-router-dom GitHub Releases](https://github.com/remix-run/react-router/releases)
- [React Router HashRouter API](https://reactrouter.com/api/declarative-routers/HashRouter)
- [React Router SPA How-To](https://reactrouter.com/how-to/spa)
- [zustand GitHub Releases](https://github.com/pmndrs/zustand/releases)
- [react-hook-form GitHub Releases](https://github.com/react-hook-form/react-hook-form/releases)
- [zod GitHub Releases](https://github.com/colinhacks/zod/releases)
- [browser-image-compression GitHub Releases](https://github.com/Donaldcwl/browser-image-compression/releases)
- [qrcode.react GitHub Releases](https://github.com/zpao/qrcode.react/releases)
- [react-qr-code GitHub Releases](https://github.com/rosskhanas/react-qr-code/releases)
- [vitest GitHub Releases](https://github.com/vitest-dev/vitest/releases)
- [Vite Static Deploy Guide](https://v2.vitejs.dev/guide/static-deploy)
- [GitHub Pages BrowserRouter discussion](https://github.com/orgs/community/discussions/36010)
