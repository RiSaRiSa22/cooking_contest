---
phase: 01-foundation-auth
plan: 03
type: execute
wave: 2
depends_on: ["01-01", "01-02"]
files_modified:
  - src/components/ui/Button.tsx
  - src/components/ui/Input.tsx
  - src/components/ui/PinInput.tsx
  - src/components/ui/Modal.tsx
  - src/components/ui/Toast.tsx
  - src/components/ui/index.ts
  - src/store/sessionStore.ts
  - src/lib/hash.ts
  - src/screens/Home/HomeScreen.tsx
  - src/router.tsx
autonomous: false

must_haves:
  truths:
    - "Home screen renders with dark background, animated flame emoji, app title in Cormorant Garamond, and two CTA buttons"
    - "Empty state shows clean layout with title + buttons, no illustrations"
    - "When sessions exist in localStorage, recent competitions list renders with competition pills"
    - "Button component renders all 5 variants (ember, gold, sage, ghost-light, ghost-dark) with pill shape and hover lift"
    - "PinInput renders 4 boxes with auto-focus-next, backspace-to-prev, and paste-spread behavior"
    - "Modal component renders as bottom sheet (default) or centered dialog with backdrop close"
    - "Toast appears at bottom, auto-dismisses after 3.2s"
  artifacts:
    - path: "src/components/ui/Button.tsx"
      provides: "Button with variants: ember, gold, sage, ghost-light, ghost-dark + sizes: default, sm, full"
      exports: ["Button"]
    - path: "src/components/ui/PinInput.tsx"
      provides: "4-box PIN input with focus management"
      exports: ["PinInput"]
    - path: "src/components/ui/Modal.tsx"
      provides: "Bottom sheet / centered dialog overlay"
      exports: ["Modal"]
    - path: "src/components/ui/Toast.tsx"
      provides: "Toast notification with auto-dismiss"
      exports: ["Toast", "useToast"]
    - path: "src/store/sessionStore.ts"
      provides: "Zustand persist store for sessions with TTL"
      exports: ["useSessionStore"]
    - path: "src/screens/Home/HomeScreen.tsx"
      provides: "Home screen with hero, recent competitions, CTA buttons"
      exports: ["HomeScreen"]
  key_links:
    - from: "src/screens/Home/HomeScreen.tsx"
      to: "src/store/sessionStore.ts"
      via: "useSessionStore hook to read recent competitions"
      pattern: "useSessionStore"
    - from: "src/router.tsx"
      to: "src/screens/Home/HomeScreen.tsx"
      via: "route element for /"
      pattern: "HomeScreen"
---

<objective>
Build the base UI component library (Button, Input, PinInput, Modal, Toast) and the home screen with session store for recent competitions.

Purpose: These components are reused across all screens (auth modals, admin panel, voter screen). The home screen is the app's entry point and the session store enables re-auth flow.
Output: 6 reusable UI components, a Zustand session store with TTL, and a complete home screen matching UI_REFERENCE.md Section 6.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-auth/01-RESEARCH.md — Pattern 4 (Zustand session store with TTL), verified PinInput pattern
@.planning/phases/01-foundation-auth/01-01-SUMMARY.md — scaffold details (Tailwind tokens, router)
@UI_REFERENCE.md — Section 3 (Components: buttons, form inputs, PIN input, upload zone, toast), Section 4 (Overlays/Modals), Section 6 (Home Screen)
</context>

<tasks>

<task type="auto">
  <name>Task 1: UI component library (Button, Input, PinInput, Modal, Toast)</name>
  <files>
    src/components/ui/Button.tsx
    src/components/ui/Input.tsx
    src/components/ui/PinInput.tsx
    src/components/ui/Modal.tsx
    src/components/ui/Toast.tsx
    src/components/ui/index.ts
  </files>
  <action>
    Create all UI components using Tailwind v4 utility classes. Reference UI_REFERENCE.md Section 3 for exact specs. Use the design tokens defined in 01-01's @theme (bg-ember, text-parchment, rounded-pill, shadow-sm, etc.).

    **Button.tsx** — Typed props: `variant` ('ember' | 'gold' | 'sage' | 'ghost-light' | 'ghost-dark'), `size` ('default' | 'sm' | 'full'), standard button props. Each variant maps to specific gradient backgrounds, text colors, and shadow as per UI_REFERENCE.md:
    - ember: gradient ember->ember-light, white text, ember shadow
    - gold: gradient gold->gold-light, ink text, gold shadow
    - sage: gradient sage->sage-light, white text
    - ghost-light: bg rgba white, border rgba white (for dark backgrounds)
    - ghost-dark: bg parchment-dark, border parchment-deep (for light backgrounds)

    All buttons: `rounded-pill` (50px), hover `translateY(-2px)` + increased shadow, transition 200ms. Sizes: default `px-7 py-4 text-[0.95rem]`, sm `px-5 py-2.5 text-[0.85rem]`, full `w-full`.

    Use Tailwind classes for gradients: `bg-gradient-to-b from-ember to-ember-light`. For shadows with color, use inline style or custom class.

    **Input.tsx** — Styled text input with label. Props: `label` (string), standard input props. Matches UI_REFERENCE.md: bg-parchment-dark, border 1.5px parchment-deep, rounded-sm (12px), focus: border-ember + ember ring. Label: uppercase, 0.72rem, tracking-wider, ink-light color.

    **PinInput.tsx** — 4-box PIN input. Props: `value` (string), `onChange` (string) => void, `onComplete` (string) => void. Each box: 62x72px, tel inputmode, numeric, maxlength 1. Focus management from RESEARCH.md verified pattern:
    - Input digit -> auto-focus next box
    - Backspace on empty -> focus previous box
    - Paste -> spread digits across boxes
    - When all 4 filled -> call onComplete
    Style: bg-parchment-dark, border 2px transparent, rounded-[14px], focus: border-ember + white bg. Font: 2rem weight-700.

    **Modal.tsx** — Overlay + sheet pattern from UI_REFERENCE.md Section 4. Props: `isOpen` (boolean), `onClose` () => void, `variant` ('bottom-sheet' | 'center'), `title` (string), `subtitle?` (string), `children`. Default variant: 'bottom-sheet'.
    - Overlay: fixed inset-0, bg rgba(26,18,8,.5), backdrop-blur(4px), z-1000
    - Sheet: bg-parchment, bottom-sheet has rounded-t-[28px], center has rounded-[28px] + margin
    - Bottom-sheet: sheet-handle (40x4px bar, parchment-deep, centered)
    - Animation: sheetUp on mount (use animate-sheet-up token)
    - Click on backdrop (outside sheet) closes modal
    - Max-height 92vh, overflow-y auto

    **Toast.tsx** — Toast notification + `useToast` hook. Fixed bottom 90px, centered, max-width 320px. Style: bg-ink, text-parchment, rounded-pill, shadow-lg. Auto-dismiss after 3.2s. Animate: fadeUp in, fadeUp out (opacity 0->1->0). The `useToast` hook returns `{ show: (message: string) => void }` and manages state internally. Render a Toast portal at the app root level.

    **index.ts** — Barrel file exporting all components.
  </action>
  <verify>
    Run `npm run dev`. Create a temporary test page that renders:
    1. All 5 Button variants — each renders with correct gradient/colors
    2. Input with label — focus shows ember border ring
    3. PinInput — type digit, auto-focuses next; backspace goes back; paste "1234" fills all boxes
    4. Modal (bottom-sheet) — opens, backdrop click closes, handle visible, animation smooth
    5. Modal (center) — renders centered with rounded corners
    6. Toast — shows message, auto-dismisses after ~3 seconds

    TypeScript: `npx tsc --noEmit` — no errors.
  </verify>
  <done>
    All 5 UI components render correctly matching UI_REFERENCE.md specs, PinInput focus management works, Modal has both variants, Toast auto-dismisses.
  </done>
</task>

<task type="auto">
  <name>Task 2: Session store + hash utility + Home screen</name>
  <files>
    src/store/sessionStore.ts
    src/lib/hash.ts
    src/screens/Home/HomeScreen.tsx
    src/router.tsx
  </files>
  <action>
    **src/lib/hash.ts** — Simple deterministic hash from RESEARCH.md verified pattern:
    ```typescript
    export function simpleHash(input: string): string {
      let hash = 0
      for (let i = 0; i < input.length; i++) {
        const char = input.charCodeAt(i)
        hash = ((hash << 5) - hash) + char
        hash = hash & hash
      }
      return Math.abs(hash).toString(16).padStart(8, '0')
    }
    ```

    **src/store/sessionStore.ts** — Zustand store with persist middleware, exact implementation from RESEARCH.md Pattern 4. Session type includes: competitionId, competitionCode, competitionName, participantId (null for admin), nickname, role ('admin' | 'participant'), authenticatedAt (Date.now()). TTL = 2 hours. Store methods: addSession, getSession (checks TTL), removeSession, clearExpired, getAllSessions (returns non-expired sessions for home screen list).

    Add a `hasHydrated` check to prevent flash of unauthenticated state (RESEARCH.md Pitfall 7):
    ```typescript
    // In the store or as a separate hook
    export const useHasHydrated = () => {
      const [hydrated, setHydrated] = useState(false)
      useEffect(() => {
        const unsubFinish = useSessionStore.persist.onFinishHydration(() => setHydrated(true))
        if (useSessionStore.persist.getOptions().storage) setHydrated(true) // already hydrated
        return unsubFinish
      }, [])
      return hydrated
    }
    ```

    **src/screens/Home/HomeScreen.tsx** — Full home screen matching UI_REFERENCE.md Section 6:

    Dark background (bg-ink), full viewport height, flex column.

    **Hero section** (flex-1, centered):
    - Flame emoji (72px) with flicker animation (`animate-flicker` from tokens)
    - App title: "Fornelli in" / "Gara" in Cormorant Garamond (font-display), parchment color. "in" and "Gara" in gold italic.
    - Subtitle: uppercase, ink-light color, wide letter-spacing

    **Recent competitions list** (if sessions exist):
    - Section label: "Le tue gare" — uppercase, micro font, ink-light
    - For each non-expired session from `useSessionStore.getAllSessions()`:
      - Competition pill: bg rgba(white, 0.06), border rgba(white, 0.10), rounded-pill
      - Content: fire emoji + competition name + meta (role badge: admin/partecipante) + chevron ">"
      - Hover: bg rgba(white, 0.10), border rgba(gold, 0.30)
      - Click: navigate to `/admin/:code` or `/voter/:code` based on role (Phase 01-04 will add re-auth check)

    **Actions section** (bottom, padded):
    - Button ember full: "Crea nuova gara" (with emoji as per UI_REFERENCE.md)
    - Button ghost-light full: "Entra con codice"
    - Both buttons are non-functional in this plan — 01-04 will wire them to modals

    **Empty state** (no sessions): Same layout but without the recent competitions section. Clean: logo, title, subtitle, buttons.

    **Update src/router.tsx:** Replace the placeholder home route element with `<HomeScreen />`.
  </action>
  <verify>
    Run `npm run dev`:
    1. Home screen renders with dark background, flame emoji animates (flicker)
    2. Title "Fornelli in Gara" renders in Cormorant Garamond with gold italic
    3. Two CTA buttons visible at bottom: ember "Crea nuova gara" + ghost "Entra con codice"
    4. Empty state: no recent competitions section visible
    5. Manually add a session via browser console: `useSessionStore.getState().addSession({...})` — recent competition pill appears on reload
    6. Session TTL: set authenticatedAt to 3 hours ago — session should not appear (expired)

    TypeScript: `npx tsc --noEmit` — no errors.
  </verify>
  <done>
    Home screen renders matching UI_REFERENCE.md Section 6 with hero, recent competitions from session store, and CTA buttons. Session store manages TTL correctly. Hash utility is available.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete UI component library and home screen</what-built>
  <how-to-verify>
    1. Open http://localhost:5173/cooking_contest/#/ (or wherever dev server runs)
    2. Verify home screen: dark background, animated flame, "Fornelli in Gara" title in serif font with gold accents, two buttons at bottom
    3. Check buttons: ember button has gradient orange background, ghost button has transparent/outlined style
    4. Check mobile feel: content is centered within ~480px max-width
    5. Open browser console, add a fake session, reload — verify competition pill appears in "Le tue gare" section
    6. Briefly test PinInput (if visible via dev tools or test page): type digits, verify auto-focus behavior
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. All 5 UI components export from `src/components/ui/index.ts`
2. Button renders 5 variants with correct gradients and hover effects
3. PinInput handles digit input, backspace, and paste correctly
4. Modal renders in both bottom-sheet and center variants
5. Toast shows and auto-dismisses
6. Session store persists to localStorage with correct TTL behavior
7. Home screen matches UI_REFERENCE.md Section 6 visual spec
8. Recent competitions list shows/hides based on session store
9. `npm run build` succeeds
</verification>

<success_criteria>
A user opening the app sees the complete home screen with the design system fully applied. The UI component library is ready for use in auth modals (01-04). The session store correctly manages competition sessions with 2-hour TTL.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-auth/01-03-SUMMARY.md`
</output>
